<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Technical Implementation | Music Besties Documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/music-besties-vuepress-docs/images/favicon.ico">
    <meta name="description" content="Comprehensive documentation for the Music Besties application">
    
    <link rel="preload" href="/music-besties-vuepress-docs/assets/css/0.styles.9fa1924b.css" as="style"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/app.304bfb85.js" as="script"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/2.29405f6f.js" as="script"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/1.fbb16ce0.js" as="script"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/89.32040f71.js" as="script"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/10.0dfdf2fe.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/11.1b42bd5e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/12.778b895b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/13.24a7caf6.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/14.7f2b4a05.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/15.cf4f697d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/16.23c9c50b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/17.a4c8d265.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/18.c74f35e3.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/19.4be7e5ae.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/20.4e193500.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/21.c9bad66e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/22.4fb405d0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/23.4d8b70d0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/24.ad8354e1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/25.fdc0487f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/26.ea09b2ae.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/27.7fe88505.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/28.c6a2a2c4.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/29.8d5d309f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/3.1330de73.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/30.63d7823c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/31.70a0cef2.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/32.2f9e820b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/33.b83761fe.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/34.897326fb.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/35.e805c8b1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/36.dacf8c9a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/37.8564f2b6.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/38.db070446.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/39.f0e77ff3.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/4.5595051a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/40.96144896.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/41.2a8bcd1e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/42.39cca6ce.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/43.6a7967b1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/44.9d45b49e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/45.b76334cb.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/46.014c066e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/47.21e8f627.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/48.6cf8eab3.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/49.a0286e2a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/5.a6633cd5.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/50.88c3de14.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/51.38fd7866.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/52.3356e701.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/53.26d4a7b3.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/54.6b51ae9d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/55.33a587f1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/56.4b884247.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/57.35d6ae29.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/58.1b5c557b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/59.80804300.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/6.00609920.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/60.97831ac2.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/61.a3e90509.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/62.7af57b0f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/63.264825e1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/64.6e6c9704.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/65.99274df3.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/66.113d8889.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/67.2874362f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/68.32276096.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/69.8825ebd9.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/7.c875f429.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/70.6626f184.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/71.6055f9d6.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/72.5e94c754.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/73.5e0b10fc.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/74.4a19b065.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/75.db5e9d8a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/76.f7bc2a5f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/77.6c26c3f8.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/78.54596091.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/79.a207d50c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/80.c5cf80ab.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/81.8f7e4040.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/82.6ecefe71.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/83.333820a5.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/84.26160b4b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/85.ee336f85.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/86.60185f61.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/87.a55eaeb0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/88.d776e7f0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/90.811240aa.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/91.f2676676.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/92.00d20f07.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/93.a5b91123.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/94.d392f21c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/95.6168502d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/96.42e70df6.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/vendors~docsearch.bd0b093a.js">
    <link rel="stylesheet" href="/music-besties-vuepress-docs/assets/css/0.styles.9fa1924b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/music-besties-vuepress-docs/" class="home-link router-link-active"><img src="/music-besties-vuepress-docs/images/logo.svg" alt="Music Besties Documentation" class="logo"> <span class="site-name can-hide">Music Besties Documentation</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/music-besties-vuepress-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/current-state/" class="nav-link">
  Current State (v1.0)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/sprint/" class="nav-link">
  Sprint to Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/next-state/" class="nav-link router-link-active">
  Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/future-states/" class="nav-link">
  Future States
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/core-functions/" class="nav-link">
  Core Functions
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/music-besties-vuepress-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/current-state/" class="nav-link">
  Current State (v1.0)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/sprint/" class="nav-link">
  Sprint to Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/next-state/" class="nav-link router-link-active">
  Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/future-states/" class="nav-link">
  Future States
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/core-functions/" class="nav-link">
  Core Functions
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/music-besties-vuepress-docs/next-state/application-overview.html" class="sidebar-link">Overview - Music Besties App</a></li><li><a href="/music-besties-vuepress-docs/next-state/screens.html" class="sidebar-link">Screens Summary</a></li><li><a href="/music-besties-vuepress-docs/next-state/components.html" class="sidebar-link">Component Details</a></li><li><a href="/music-besties-vuepress-docs/next-state/interactions.html" class="sidebar-link">Interactions</a></li><li><a href="/music-besties-vuepress-docs/next-state/technical.html" aria-current="page" class="active sidebar-link">Technical Implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#architecture-overview" class="sidebar-link">Architecture Overview</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#local-storage-schema" class="sidebar-link">Local Storage Schema</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#history-tracking-implementation" class="sidebar-link">History Tracking Implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#change-detection-algorithm" class="sidebar-link">Change Detection Algorithm</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#history-entry-creation" class="sidebar-link">History Entry Creation</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#cooldown-timer-implementation" class="sidebar-link">Cooldown Timer Implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#time-calculation" class="sidebar-link">Time Calculation</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#save-eligibility-check" class="sidebar-link">Save Eligibility Check</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#social-matching-algorithm" class="sidebar-link">Social Matching Algorithm</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#similarity-calculation" class="sidebar-link">Similarity Calculation</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#reddit-oauth-integration" class="sidebar-link">Reddit OAuth Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#authorization-flow" class="sidebar-link">Authorization Flow</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#subscription-verification" class="sidebar-link">Subscription Verification</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#privacy-control-system" class="sidebar-link">Privacy Control System</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#content-visibility-check" class="sidebar-link">Content Visibility Check</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#shareable-content-generation" class="sidebar-link">Shareable Content Generation</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#guest-mode-implementation" class="sidebar-link">Guest Mode Implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#guest-account-creation" class="sidebar-link">Guest Account Creation</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#account-upgrade" class="sidebar-link">Account Upgrade</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#performance-optimizations" class="sidebar-link">Performance Optimizations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#lazy-loading" class="sidebar-link">Lazy Loading</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#memoization" class="sidebar-link">Memoization</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#virtualized-lists" class="sidebar-link">Virtualized Lists</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#security-considerations" class="sidebar-link">Security Considerations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#csrf-protection" class="sidebar-link">CSRF Protection</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#content-security-policy" class="sidebar-link">Content Security Policy</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#secure-storage" class="sidebar-link">Secure Storage</a></li></ul></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#browser-compatibility" class="sidebar-link">Browser Compatibility</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#testing-strategy" class="sidebar-link">Testing Strategy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#unit-tests" class="sidebar-link">Unit Tests</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#integration-tests" class="sidebar-link">Integration Tests</a></li><li class="sidebar-sub-header"><a href="/music-besties-vuepress-docs/next-state/technical.html#end-to-end-tests" class="sidebar-link">End-to-End Tests</a></li></ul></li></ul></li><li><a href="/music-besties-vuepress-docs/next-state/user-experience.html" class="sidebar-link">User Navigation</a></li><li><a href="/music-besties-vuepress-docs/next-state/developer-guide.html" class="sidebar-link">Developer Guide</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="technical-implementation"><a href="#technical-implementation" class="header-anchor">#</a> Technical Implementation</h1> <p>This section provides detailed technical information about the implementation of Music Besties v1.1 features.</p> <h2 id="architecture-overview"><a href="#architecture-overview" class="header-anchor">#</a> Architecture Overview</h2> <p>Music Besties follows a component-based architecture using Vue.js with a local-first data approach. The v1.1 release introduces several new technical components:</p> <ol><li><strong>History Tracking System</strong>: Versioned history of user rankings with change detection</li> <li><strong>Cooldown Timer</strong>: Time-based restrictions on ranking saves</li> <li><strong>Social Matching Algorithm</strong>: Similarity calculation between user preferences</li> <li><strong>Reddit OAuth Integration</strong>: External authentication and verification</li> <li><strong>Privacy Control System</strong>: Granular permission management for shared content</li></ol> <h2 id="local-storage-schema"><a href="#local-storage-schema" class="header-anchor">#</a> Local Storage Schema</h2> <p>The application uses browser localStorage as its primary data store, with the following schema:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// localStorage['music-besties-data']</span>
<span class="token punctuation">{</span>
  <span class="token comment">// Core user selections (from v1.0)</span>
  <span class="token string-property property">&quot;rankings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;red&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;all_too_well&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;state_of_grace&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;22&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;fearless&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;love_story&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you_belong_with_me&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fifteen&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// User reviews (from v1.0)</span>
  <span class="token string-property property">&quot;reviews&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;red&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;rating&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This album perfectly captures the emotions of heartbreak.&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2025-05-05T15:30:00.000Z&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// New in v1.1: Ranking history with change tracking</span>
  <span class="token string-property property">&quot;history&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;red&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hist_1683590400000&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2025-05-08T15:00:00.000Z&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;changes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;songId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;state_of_grace&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;oldRank&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;newRank&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;changeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;moved&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;songId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;oldRank&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;newRank&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;changeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;moved&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// New in v1.1: Cooldown timer tracking</span>
  <span class="token string-property property">&quot;lastSaveTime&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;red&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2025-05-08T15:00:00.000Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;fearless&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2025-05-07T10:30:00.000Z&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// New in v1.1: User account information</span>
  <span class="token string-property property">&quot;userAccount&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;userId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_12345&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;displayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MusicLover&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;isGuest&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;createdAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2025-05-01T09:00:00.000Z&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// New in v1.1: Privacy settings</span>
  <span class="token string-property property">&quot;privacySettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;publicProfile&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;showRankings&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;showReviews&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;showBesties&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// New in v1.1: Reddit verification</span>
  <span class="token string-property property">&quot;redditVerification&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;music_fan_123&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;isVerified&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;verifiedDate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2025-05-05T09:15:00.000Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;verificationStatus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;verified&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="history-tracking-implementation"><a href="#history-tracking-implementation" class="header-anchor">#</a> History Tracking Implementation</h2> <p>The history tracking system records changes to user rankings over time:</p> <h3 id="change-detection-algorithm"><a href="#change-detection-algorithm" class="header-anchor">#</a> Change Detection Algorithm</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token parameter">oldRanking<span class="token punctuation">,</span> newRanking</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> changes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Find removed items</span>
  oldRanking<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">songId<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newRanking<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>songId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      changes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        songId<span class="token punctuation">,</span>
        <span class="token literal-property property">oldRank</span><span class="token operator">:</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">newRank</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">changeType</span><span class="token operator">:</span> <span class="token string">'removed'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Find added or moved items</span>
  newRanking<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">songId<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldIndex <span class="token operator">=</span> oldRanking<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>songId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldIndex <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Added</span>
      changes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        songId<span class="token punctuation">,</span>
        <span class="token literal-property property">oldRank</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">newRank</span><span class="token operator">:</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">changeType</span><span class="token operator">:</span> <span class="token string">'added'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldIndex <span class="token operator">!==</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Moved</span>
      changes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        songId<span class="token punctuation">,</span>
        <span class="token literal-property property">oldRank</span><span class="token operator">:</span> oldIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">newRank</span><span class="token operator">:</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">changeType</span><span class="token operator">:</span> <span class="token string">'moved'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> changes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="history-entry-creation"><a href="#history-entry-creation" class="header-anchor">#</a> History Entry Creation</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createHistoryEntry</span><span class="token punctuation">(</span><span class="token parameter">albumId<span class="token punctuation">,</span> oldRanking<span class="token punctuation">,</span> newRanking</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> changes <span class="token operator">=</span> <span class="token function">detectChanges</span><span class="token punctuation">(</span>oldRanking<span class="token punctuation">,</span> newRanking<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Only create history if there are changes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>changes<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hist_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timestamp<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> timestamp<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    changes
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="cooldown-timer-implementation"><a href="#cooldown-timer-implementation" class="header-anchor">#</a> Cooldown Timer Implementation</h2> <p>The cooldown timer enforces a 24-hour waiting period between ranking saves:</p> <h3 id="time-calculation"><a href="#time-calculation" class="header-anchor">#</a> Time Calculation</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">calculateTimeRemaining</span><span class="token punctuation">(</span><span class="token parameter">lastSaveTime<span class="token punctuation">,</span> cooldownHours <span class="token operator">=</span> <span class="token number">24</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lastSaveTime<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastSave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>lastSaveTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cooldownEnd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>lastSave<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>cooldownHours <span class="token operator">*</span> <span class="token number">3600000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cooldownEnd <span class="token operator">-</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="save-eligibility-check"><a href="#save-eligibility-check" class="header-anchor">#</a> Save Eligibility Check</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">canSaveRankings</span><span class="token punctuation">(</span><span class="token parameter">albumId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastSaveTimes <span class="token operator">=</span> userData<span class="token punctuation">.</span>lastSaveTime <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastSaveTime <span class="token operator">=</span> lastSaveTimes<span class="token punctuation">[</span>albumId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token function">calculateTimeRemaining</span><span class="token punctuation">(</span>lastSaveTime<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="social-matching-algorithm"><a href="#social-matching-algorithm" class="header-anchor">#</a> Social Matching Algorithm</h2> <p>The bestie matching feature uses a similarity algorithm to find users with similar music taste:</p> <h3 id="similarity-calculation"><a href="#similarity-calculation" class="header-anchor">#</a> Similarity Calculation</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">calculateSimilarity</span><span class="token punctuation">(</span><span class="token parameter">userA<span class="token punctuation">,</span> userB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get all albums ranked by both users</span>
  <span class="token keyword">const</span> commonAlbums <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>userA<span class="token punctuation">.</span>rankings<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">albumId</span> <span class="token operator">=&gt;</span> 
    userB<span class="token punctuation">.</span>rankings<span class="token punctuation">[</span>albumId<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> userB<span class="token punctuation">.</span>rankings<span class="token punctuation">[</span>albumId<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>commonAlbums<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  
  <span class="token keyword">let</span> totalSimilarity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> commonFavorites <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Calculate similarity for each common album</span>
  commonAlbums<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">albumId</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> rankingsA <span class="token operator">=</span> userA<span class="token punctuation">.</span>rankings<span class="token punctuation">[</span>albumId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> rankingsB <span class="token operator">=</span> userB<span class="token punctuation">.</span>rankings<span class="token punctuation">[</span>albumId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Find songs ranked by both users</span>
    <span class="token keyword">const</span> commonSongs <span class="token operator">=</span> rankingsA<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">songId</span> <span class="token operator">=&gt;</span> rankingsB<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>songId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Calculate position similarity</span>
    <span class="token keyword">let</span> positionSimilarity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    commonSongs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">songId</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> posA <span class="token operator">=</span> rankingsA<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>songId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> posB <span class="token operator">=</span> rankingsB<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>songId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> posDiff <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>posA <span class="token operator">-</span> posB<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> maxPos <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>rankingsA<span class="token punctuation">.</span>length<span class="token punctuation">,</span> rankingsB<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      
      <span class="token comment">// Higher similarity for songs ranked in similar positions</span>
      positionSimilarity <span class="token operator">+=</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>posDiff <span class="token operator">/</span> maxPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// Track common favorites (songs in top 3 for both users)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>posA <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> posB <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        commonFavorites<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>songId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Normalize position similarity</span>
    positionSimilarity <span class="token operator">=</span> commonSongs<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> 
      positionSimilarity <span class="token operator">/</span> commonSongs<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Calculate overlap ratio</span>
    <span class="token keyword">const</span> overlapRatio <span class="token operator">=</span> commonSongs<span class="token punctuation">.</span>length <span class="token operator">/</span> 
      Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>rankingsA<span class="token punctuation">.</span>length<span class="token punctuation">,</span> rankingsB<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Combine metrics for this album</span>
    <span class="token keyword">const</span> albumSimilarity <span class="token operator">=</span> <span class="token punctuation">(</span>positionSimilarity <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>overlapRatio <span class="token operator">*</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    totalSimilarity <span class="token operator">+=</span> albumSimilarity<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Calculate final similarity percentage</span>
  <span class="token keyword">const</span> averageSimilarity <span class="token operator">=</span> totalSimilarity <span class="token operator">/</span> commonAlbums<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> similarityPercentage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>averageSimilarity <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">matchPercentage</span><span class="token operator">:</span> similarityPercentage<span class="token punctuation">,</span>
    <span class="token literal-property property">commonFavorites</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>commonFavorites<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// Top 5 common favorites</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="reddit-oauth-integration"><a href="#reddit-oauth-integration" class="header-anchor">#</a> Reddit OAuth Integration</h2> <p>The Reddit verification process uses OAuth 2.0 for authentication:</p> <h3 id="authorization-flow"><a href="#authorization-flow" class="header-anchor">#</a> Authorization Flow</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Step 1: Redirect to Reddit authorization page</span>
<span class="token keyword">function</span> <span class="token function">initiateRedditAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> clientId <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_REDDIT_CLIENT_ID</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> redirectUri <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_REDDIT_REDIRECT_URI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">generateRandomState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// For CSRF protection</span>
  <span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'identity read'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Store state for verification</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'redditAuthState'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Redirect to Reddit</span>
  <span class="token keyword">const</span> authUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.reddit.com/api/v1/authorize?client_id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clientId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;response_type=code&amp;state=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;redirect_uri=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>redirectUri<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;duration=temporary&amp;scope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scope<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> authUrl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Step 2: Handle the callback from Reddit</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRedditCallback</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Verify state to prevent CSRF attacks</span>
  <span class="token keyword">const</span> storedState <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'redditAuthState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">!==</span> storedState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'State verification failed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Exchange code for token</span>
  <span class="token keyword">const</span> tokenResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">exchangeCodeForToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Use token to get user information</span>
  <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span>tokenResponse<span class="token punctuation">.</span>access_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Verify user subscriptions</span>
  <span class="token keyword">const</span> isVerified <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">checkUserSubscriptions</span><span class="token punctuation">(</span>tokenResponse<span class="token punctuation">.</span>access_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Store verification result</span>
  <span class="token function">storeVerificationResult</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>name<span class="token punctuation">,</span> isVerified<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    isVerified<span class="token punctuation">,</span>
    <span class="token literal-property property">verificationStatus</span><span class="token operator">:</span> isVerified <span class="token operator">?</span> <span class="token string">'verified'</span> <span class="token operator">:</span> <span class="token string">'failed'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="subscription-verification"><a href="#subscription-verification" class="header-anchor">#</a> Subscription Verification</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkUserSubscriptions</span><span class="token punctuation">(</span><span class="token parameter">accessToken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// List of positive community subreddits to check</span>
  <span class="token keyword">const</span> positiveSubreddits <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'taylorswift'</span><span class="token punctuation">,</span>
    <span class="token string">'popheads'</span><span class="token punctuation">,</span>
    <span class="token string">'musicappreciation'</span><span class="token punctuation">,</span>
    <span class="token comment">// Additional communities can be added here</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://oauth.reddit.com/subreddits/mine/subscriber'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Authorization'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accessToken<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token string-property property">'User-Agent'</span><span class="token operator">:</span> <span class="token string">'Music Besties/1.1'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> subscribedSubreddits <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> 
      child<span class="token punctuation">.</span>data<span class="token punctuation">.</span>display_name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Check if user is subscribed to at least one positive community</span>
    <span class="token keyword">return</span> positiveSubreddits<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">subreddit</span> <span class="token operator">=&gt;</span> 
      subscribedSubreddits<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>subreddit<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error checking subscriptions:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="privacy-control-system"><a href="#privacy-control-system" class="header-anchor">#</a> Privacy Control System</h2> <p>The privacy control system manages what content is visible to other users:</p> <h3 id="content-visibility-check"><a href="#content-visibility-check" class="header-anchor">#</a> Content Visibility Check</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isContentVisible</span><span class="token punctuation">(</span><span class="token parameter">contentType<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get user's privacy settings</span>
  <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> privacySettings <span class="token operator">=</span> userData<span class="token punctuation">.</span>privacySettings <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Public profile must be enabled for any content to be visible</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>privacySettings<span class="token punctuation">.</span>publicProfile<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Check specific content type visibility</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'rankings'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> privacySettings<span class="token punctuation">.</span>showRankings <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'reviews'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> privacySettings<span class="token punctuation">.</span>showReviews <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'besties'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> privacySettings<span class="token punctuation">.</span>showBesties <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="shareable-content-generation"><a href="#shareable-content-generation" class="header-anchor">#</a> Shareable Content Generation</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">generateShareableContent</span><span class="token punctuation">(</span><span class="token parameter">contentType<span class="token punctuation">,</span> contentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get user data</span>
  <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Check privacy settings</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isContentVisible</span><span class="token punctuation">(</span>contentType<span class="token punctuation">,</span> userData<span class="token punctuation">.</span>userAccount<span class="token operator">?.</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'This content is not set to be publicly visible'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Generate appropriate content based on type</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'rankings'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> rankings <span class="token operator">=</span> userData<span class="token punctuation">.</span>rankings<span class="token punctuation">[</span>contentId<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> albumName <span class="token operator">=</span> <span class="token function">getAlbumName</span><span class="token punctuation">(</span>contentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'rankings'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">albumId</span><span class="token operator">:</span> contentId<span class="token punctuation">,</span>
        albumName<span class="token punctuation">,</span>
        rankings<span class="token punctuation">,</span>
        <span class="token literal-property property">shareUrl</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://musicbesties.app/share/rankings/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">previewText</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Check out my </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>albumName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> song rankings on Music Besties!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">previewImage</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://musicbesties.app/album-previews/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'reviews'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> review <span class="token operator">=</span> userData<span class="token punctuation">.</span>reviews<span class="token punctuation">[</span>contentId<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> albumName <span class="token operator">=</span> <span class="token function">getAlbumName</span><span class="token punctuation">(</span>contentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'review'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">albumId</span><span class="token operator">:</span> contentId<span class="token punctuation">,</span>
        albumName<span class="token punctuation">,</span>
        <span class="token literal-property property">rating</span><span class="token operator">:</span> review<span class="token punctuation">.</span>rating<span class="token punctuation">,</span>
        <span class="token literal-property property">comment</span><span class="token operator">:</span> review<span class="token punctuation">.</span>comment<span class="token punctuation">,</span>
        <span class="token literal-property property">shareUrl</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://musicbesties.app/share/review/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">previewText</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>review<span class="token punctuation">.</span>rating<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-star review of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>albumName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> on Music Besties</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">previewImage</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://musicbesties.app/album-previews/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unsupported content type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="guest-mode-implementation"><a href="#guest-mode-implementation" class="header-anchor">#</a> Guest Mode Implementation</h2> <p>Guest mode allows users to use the app without creating an account:</p> <h3 id="guest-account-creation"><a href="#guest-account-creation" class="header-anchor">#</a> Guest Account Creation</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createGuestAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> guestId <span class="token operator">=</span> <span class="token string">'guest_'</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Create guest account</span>
  userData<span class="token punctuation">.</span>userAccount <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">userId</span><span class="token operator">:</span> guestId<span class="token punctuation">,</span>
    <span class="token literal-property property">displayName</span><span class="token operator">:</span> <span class="token string">'Guest User'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isGuest</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Set default privacy settings (all private for guests)</span>
  userData<span class="token punctuation">.</span>privacySettings <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">publicProfile</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showRankings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showReviews</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showBesties</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Save to localStorage</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> userData<span class="token punctuation">.</span>userAccount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="account-upgrade"><a href="#account-upgrade" class="header-anchor">#</a> Account Upgrade</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">upgradeGuestAccount</span><span class="token punctuation">(</span><span class="token parameter">email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> displayName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get current user data</span>
  <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Create account in Supabase</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> supabase<span class="token punctuation">.</span>auth<span class="token punctuation">.</span><span class="token function">signUp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    email<span class="token punctuation">,</span>
    password
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  
  <span class="token comment">// Update user account information</span>
  userData<span class="token punctuation">.</span>userAccount <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">userId</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token literal-property property">displayName</span><span class="token operator">:</span> displayName <span class="token operator">||</span> userData<span class="token punctuation">.</span>userAccount<span class="token operator">?.</span>displayName <span class="token operator">||</span> <span class="token string">'Music Fan'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isGuest</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">createdAt</span><span class="token operator">:</span> userData<span class="token punctuation">.</span>userAccount<span class="token operator">?.</span>createdAt <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    email
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Set default privacy settings for new accounts</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>userData<span class="token punctuation">.</span>privacySettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userData<span class="token punctuation">.</span>privacySettings <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">publicProfile</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">showRankings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">showReviews</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">showBesties</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Save to localStorage</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'music-besties-data'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Sync data to Supabase for the new account</span>
  <span class="token keyword">await</span> <span class="token function">syncDataToCloud</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> userData<span class="token punctuation">.</span>userAccount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="performance-optimizations"><a href="#performance-optimizations" class="header-anchor">#</a> Performance Optimizations</h2> <p>Several optimizations have been implemented to ensure good performance:</p> <h3 id="lazy-loading"><a href="#lazy-loading" class="header-anchor">#</a> Lazy Loading</h3> <p>Components are loaded only when needed:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Vue Router configuration</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./views/Dashboard.vue'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/edit'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./views/EditRankings.vue'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/besties'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./views/BestieMatching.vue'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/onboarding'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./views/Onboarding.vue'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="memoization"><a href="#memoization" class="header-anchor">#</a> Memoization</h3> <p>Expensive calculations are cached:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Memoized similarity calculation</span>
<span class="token keyword">const</span> similarityCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getMemoizedSimilarity</span><span class="token punctuation">(</span><span class="token parameter">userIdA<span class="token punctuation">,</span> userIdB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cacheKey <span class="token operator">=</span> <span class="token punctuation">[</span>userIdA<span class="token punctuation">,</span> userIdB<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>similarityCache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> similarityCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">calculateSimilarity</span><span class="token punctuation">(</span><span class="token function">getUserData</span><span class="token punctuation">(</span>userIdA<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getUserData</span><span class="token punctuation">(</span>userIdB<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  similarityCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="virtualized-lists"><a href="#virtualized-lists" class="header-anchor">#</a> Virtualized Lists</h3> <p>Large lists use virtualization for better performance:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Example of virtualized list component</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;virtualized-list&quot;</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">&quot;{ height: totalHeight + 'px' }&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div 
      v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;item in visibleItems&quot;</span> 
      <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;item.id&quot;</span>
      <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">&quot;{ transform: `translateY(${item.offsetTop}px)` }&quot;</span>
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;list-item&quot;</span>
    <span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>content <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">items</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
    <span class="token literal-property property">itemHeight</span><span class="token operator">:</span> Number
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">scrollTop</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">viewportHeight</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">totalHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">visibleItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> startIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> endIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
        Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>viewportHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items
        <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startIndex<span class="token punctuation">,</span> endIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token operator">...</span>item<span class="token punctuation">,</span>
          <span class="token literal-property property">offsetTop</span><span class="token operator">:</span> <span class="token punctuation">(</span>startIndex <span class="token operator">+</span> index<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>viewportHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleScroll<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleScroll<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> window<span class="token punctuation">.</span>scrollY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="security-considerations"><a href="#security-considerations" class="header-anchor">#</a> Security Considerations</h2> <p>Security measures have been implemented to protect user data:</p> <h3 id="csrf-protection"><a href="#csrf-protection" class="header-anchor">#</a> CSRF Protection</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">generateRandomState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span><span class="token function">getRandomValues</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token parameter">byte</span> <span class="token operator">=&gt;</span> byte<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="content-security-policy"><a href="#content-security-policy" class="header-anchor">#</a> Content Security Policy</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>
  default-src 'self';
  connect-src 'self' https://oauth.reddit.com https://*.supabase.co;
  img-src 'self' https://i.redd.it https://*.scdn.co data:;
  script-src 'self' 'unsafe-inline';
  style-src 'self' 'unsafe-inline';
  frame-src 'none';
<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="secure-storage"><a href="#secure-storage" class="header-anchor">#</a> Secure Storage</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Sensitive data is not stored in localStorage</span>
<span class="token keyword">function</span> <span class="token function">storeAuthToken</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use sessionStorage for temporary auth tokens</span>
  sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'reddit_token'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Set expiration</span>
  <span class="token keyword">const</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  expiration<span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span>expiration<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'reddit_token_expiration'</span><span class="token punctuation">,</span> expiration<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="browser-compatibility"><a href="#browser-compatibility" class="header-anchor">#</a> Browser Compatibility</h2> <p>The application is designed to work on modern browsers with these minimum versions:</p> <table><thead><tr><th>Browser</th> <th>Minimum Version</th></tr></thead> <tbody><tr><td>Chrome</td> <td>80</td></tr> <tr><td>Firefox</td> <td>72</td></tr> <tr><td>Safari</td> <td>13.1</td></tr> <tr><td>Edge</td> <td>80</td></tr></tbody></table> <p>Feature detection is used for newer browser capabilities:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Example of feature detection</span>
<span class="token keyword">function</span> <span class="token function">supportsLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">supportsIndexedDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'indexedDB'</span> <span class="token keyword">in</span> window<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Choose appropriate storage mechanism</span>
<span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token function">supportsIndexedDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">IndexedDBStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                <span class="token function">supportsLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">LocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                <span class="token keyword">new</span> <span class="token class-name">MemoryStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="testing-strategy"><a href="#testing-strategy" class="header-anchor">#</a> Testing Strategy</h2> <p>The application is tested using the following approaches:</p> <h3 id="unit-tests"><a href="#unit-tests" class="header-anchor">#</a> Unit Tests</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Example Jest test for cooldown timer</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Cooldown Timer'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should correctly calculate time remaining'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Mock current time</span>
    jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>Date<span class="token punctuation">,</span> <span class="token string">'now'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1620500000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// May 8, 2025, 15:00:00 GMT</span>
    
    <span class="token comment">// Test with lastSaveTime 12 hours ago</span>
    <span class="token keyword">const</span> lastSaveTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1620456800000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// May 8, 2025, 03:00:00 GMT</span>
    <span class="token keyword">const</span> timeRemaining <span class="token operator">=</span> <span class="token function">calculateTimeRemaining</span><span class="token punctuation">(</span>lastSaveTime<span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Should have 12 hours remaining</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>timeRemaining <span class="token operator">/</span> <span class="token number">3600000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should return 0 when cooldown is complete'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Mock current time</span>
    jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>Date<span class="token punctuation">,</span> <span class="token string">'now'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1620500000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// May 8, 2025, 15:00:00 GMT</span>
    
    <span class="token comment">// Test with lastSaveTime 25 hours ago</span>
    <span class="token keyword">const</span> lastSaveTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1620410400000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// May 7, 2025, 14:00:00 GMT</span>
    <span class="token keyword">const</span> timeRemaining <span class="token operator">=</span> <span class="token function">calculateTimeRemaining</span><span class="token punctuation">(</span>lastSaveTime<span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Should have 0 hours remaining</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>timeRemaining<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="integration-tests"><a href="#integration-tests" class="header-anchor">#</a> Integration Tests</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Example Cypress test for Reddit verification</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Reddit Verification'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Mock Reddit OAuth response</span>
    cy<span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'https://www.reddit.com/api/v1/access_token'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">statusCode</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">access_token</span><span class="token operator">:</span> <span class="token string">'mock_token'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">token_type</span><span class="token operator">:</span> <span class="token string">'bearer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">expires_in</span><span class="token operator">:</span> <span class="token number">3600</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Mock user info response</span>
    cy<span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://oauth.reddit.com/api/v1/me'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">statusCode</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test_user'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'t2_12345'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Mock subscriptions response</span>
    cy<span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://oauth.reddit.com/subreddits/mine/subscriber'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">statusCode</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">display_name</span><span class="token operator">:</span> <span class="token string">'taylorswift'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">display_name</span><span class="token operator">:</span> <span class="token string">'AskReddit'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should complete verification flow successfully'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Start verification</span>
    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">'/settings'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;connect-reddit&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Simulate OAuth callback</span>
    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">'/auth/reddit/callback?code=test_code&amp;state=test_state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Check verification status</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;verification-status&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'contain'</span><span class="token punctuation">,</span> <span class="token string">'Verified'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;reddit-username&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'contain'</span><span class="token punctuation">,</span> <span class="token string">'test_user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="end-to-end-tests"><a href="#end-to-end-tests" class="header-anchor">#</a> End-to-End Tests</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Example Playwright test for the entire ranking flow</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'complete ranking flow with cooldown'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> page <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Login</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;email-input&quot;]'</span><span class="token punctuation">,</span> <span class="token string">'test@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;password-input&quot;]'</span><span class="token punctuation">,</span> <span class="token string">'password123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;login-button&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Navigate to edit rankings</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;dashboard-era-red&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;edit-button&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Select songs</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;song-all-too-well&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;song-state-of-grace&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;song-22&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Save rankings</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;save-button&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Verify we're back on dashboard</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveURL</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Try to edit again immediately</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;dashboard-era-red&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;edit-button&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Verify cooldown timer is visible</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;cooldown-timer&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'[data-test=&quot;save-button&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDisabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/9/2025, 12:46:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/music-besties-vuepress-docs/next-state/interactions.html" class="prev">
        Interactions
      </a></span> <span class="next"><a href="/music-besties-vuepress-docs/next-state/user-experience.html">
        User Navigation
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/music-besties-vuepress-docs/assets/js/app.304bfb85.js" defer></script><script src="/music-besties-vuepress-docs/assets/js/2.29405f6f.js" defer></script><script src="/music-besties-vuepress-docs/assets/js/1.fbb16ce0.js" defer></script><script src="/music-besties-vuepress-docs/assets/js/89.32040f71.js" defer></script>
  </body>
</html>
