<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Supabase Database Operations Guide | Music Besties Documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/music-besties-vuepress-docs/images/favicon.ico">
    <meta name="description" content="Comprehensive documentation for the Music Besties application">
    
    <link rel="preload" href="/music-besties-vuepress-docs/assets/css/0.styles.9fa1924b.css" as="style"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/app.fdb73f2f.js" as="script"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/2.29405f6f.js" as="script"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/1.fbb16ce0.js" as="script"><link rel="preload" href="/music-besties-vuepress-docs/assets/js/39.35a0cd58.js" as="script"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/10.0dfdf2fe.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/11.1b42bd5e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/12.778b895b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/13.24a7caf6.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/14.7f2b4a05.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/15.cf4f697d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/16.23c9c50b.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/17.a4c8d265.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/18.c74f35e3.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/19.4be7e5ae.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/20.4e193500.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/21.c9bad66e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/22.4fb405d0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/23.4d8b70d0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/24.5066ef5d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/25.00820f40.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/26.1a1c6bb4.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/27.5337f46f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/28.62985656.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/29.c3df1949.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/3.1330de73.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/30.e0ea2b54.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/31.096d2589.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/32.ac05d375.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/33.b83761fe.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/34.4c2eba7c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/35.e805c8b1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/36.dacf8c9a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/37.4f3d9931.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/38.80586369.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/4.5595051a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/40.320ebabd.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/41.0e7c6e31.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/42.4d69c481.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/43.5640d589.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/44.6fc32279.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/45.73229990.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/46.c6864247.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/47.6090c4cd.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/48.2282b682.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/49.21ba7889.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/5.a6633cd5.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/50.9903cf7c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/51.11e15a1d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/52.704ee6f0.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/53.4bfe1b05.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/54.f8e24b32.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/55.ba237953.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/56.8ad67e1e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/57.4dc4fa2a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/58.9d81374d.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/59.0f0100e1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/6.00609920.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/60.65b287de.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/61.1d89ea40.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/62.06a64d11.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/63.25c752ee.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/64.8f640b8f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/65.8e0c0072.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/66.8ab72c9e.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/67.94ce2991.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/68.14ad8f39.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/69.b17fdb9a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/7.c875f429.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/70.112e2c67.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/71.8fb94c59.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/72.34e8b48f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/73.45bb2dee.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/74.44347467.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/75.e3c526b1.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/76.c3426a91.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/77.159f948a.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/78.c76b5661.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/79.ffe52162.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/80.4d729eee.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/81.1278bbcb.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/82.2e99eac7.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/83.63ff2a8f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/84.3e41f57c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/85.00f7334f.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/86.f92a5381.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/87.e7c88b14.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/88.0d4d8ed5.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/89.876e371c.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/90.a2d604e6.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/91.9063c592.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/92.5a1005de.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/93.d2660ab4.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/94.675e5d05.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/95.04e7adcc.js"><link rel="prefetch" href="/music-besties-vuepress-docs/assets/js/vendors~docsearch.bd0b093a.js">
    <link rel="stylesheet" href="/music-besties-vuepress-docs/assets/css/0.styles.9fa1924b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/music-besties-vuepress-docs/" class="home-link router-link-active"><img src="/music-besties-vuepress-docs/images/logo.svg" alt="Music Besties Documentation" class="logo"> <span class="site-name can-hide">Music Besties Documentation</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/music-besties-vuepress-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/current-state/" class="nav-link">
  Current State (v1.0)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/sprint/" class="nav-link">
  Sprint to Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/next-state/" class="nav-link">
  Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/future-states/" class="nav-link">
  Future States
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/core-functions/" class="nav-link router-link-active">
  Core Functions
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/music-besties-vuepress-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/current-state/" class="nav-link">
  Current State (v1.0)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/sprint/" class="nav-link">
  Sprint to Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/next-state/" class="nav-link">
  Next State (v1.1)
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/future-states/" class="nav-link">
  Future States
</a></div><div class="nav-item"><a href="/music-besties-vuepress-docs/core-functions/" class="nav-link router-link-active">
  Core Functions
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/music-besties-vuepress-docs/core-functions/documentation-guide.html" class="sidebar-link">Documentation Guide</a></li><li><a href="/music-besties-vuepress-docs/core-functions/mermaid-diagram-guide.html" class="sidebar-link">Mermaid Diagram Style Guide</a></li><li><a href="/music-besties-vuepress-docs/core-functions/version-control-guide.html" class="sidebar-link">Version Control Guide</a></li><li><a href="/music-besties-vuepress-docs/core-functions/security.html" class="sidebar-link">Security Considerations</a></li><li><a href="/music-besties-vuepress-docs/core-functions/api-documentation.html" class="sidebar-link">API Documentation</a></li><li><a href="/music-besties-vuepress-docs/core-functions/deployment.html" class="sidebar-link">Deployment and Infrastructure</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Design System</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="supabase-database-operations-guide"><a href="#supabase-database-operations-guide" class="header-anchor">#</a> Supabase Database Operations Guide</h1> <h2 id="_1-introduction"><a href="#_1-introduction" class="header-anchor">#</a> 1. Introduction</h2> <p>This guide documents the various database operations for working with Supabase in this project. It covers setting up database access, querying user data, managing test users, and includes reusable scripts for common operations.</p> <p>The primary tables we work with are:</p> <ul><li><code>auth.users</code> - Contains user authentication information</li> <li><code>public.profiles</code> - Contains additional user profile information</li></ul> <h2 id="_2-setting-up-database-access"><a href="#_2-setting-up-database-access" class="header-anchor">#</a> 2. Setting Up Database Access</h2> <h3 id="adding-psql-to-system-path"><a href="#adding-psql-to-system-path" class="header-anchor">#</a> Adding PSQL to System PATH</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># Add PostgreSQL binaries to PATH permanently</span>
<span class="token variable">$env</span>:Path <span class="token operator">+=</span> <span class="token string">&quot;;C:\Program Files\PostgreSQL\17\bin&quot;</span>
<span class="token namespace">[Environment]</span>::SetEnvironmentVariable<span class="token punctuation">(</span><span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span> <span class="token variable">$env</span>:Path<span class="token punctuation">,</span> <span class="token namespace">[System.EnvironmentVariableTarget]</span>::User<span class="token punctuation">)</span>

<span class="token comment"># Verify installation</span>
psql <span class="token operator">--</span>version
</code></pre></div><h3 id="supabase-connection-parameters"><a href="#supabase-connection-parameters" class="header-anchor">#</a> Supabase Connection Parameters</h3> <p>The following connection parameters are used for accessing the Supabase database:</p> <ul><li>Host: <code>aws-0-eu-central-1.pooler.supabase.com</code></li> <li>Port: <code>5432</code></li> <li>Database: <code>postgres</code></li> <li>Username: <code>postgres.wnaxmgtrdhlousolblcr</code></li> <li>SSL Mode: <code>require</code></li></ul> <h3 id="securely-storing-database-credentials"><a href="#securely-storing-database-credentials" class="header-anchor">#</a> Securely Storing Database Credentials</h3> <p>We use Windows Credential Manager to securely store database credentials. This approach is more secure than storing passwords in plain text files and eliminates the need to enter passwords repeatedly.</p> <h4 id="setting-up-credentials-one-time-setup"><a href="#setting-up-credentials-one-time-setup" class="header-anchor">#</a> Setting Up Credentials (One-Time Setup)</h4> <p>Run the <code>setup_db_credentials.ps1</code> script to securely store your database password:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># setup_db_credentials.ps1</span>
<span class="token comment"># Import the CredentialManager module</span>
<span class="token function">Import-Module</span> CredentialManager

<span class="token comment"># Prompt for the database password securely</span>
<span class="token variable">$username</span> = <span class="token string">&quot;postgres.wnaxmgtrdhlousolblcr&quot;</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;Setting up secure credentials for Supabase database&quot;</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;Username: <span class="token variable">$username</span>&quot;</span>
<span class="token variable">$password</span> = <span class="token function">Read-Host</span> <span class="token string">&quot;Enter your Supabase database password&quot;</span> <span class="token operator">-</span>AsSecureString

<span class="token comment"># Create a PSCredential object</span>
<span class="token variable">$credential</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>PSCredential<span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span>

<span class="token comment"># Store the credential in Windows Credential Manager</span>
<span class="token function">New-StoredCredential</span> <span class="token operator">-</span>Credential <span class="token variable">$credential</span> <span class="token operator">-</span>Target <span class="token string">&quot;SupabaseDB&quot;</span> <span class="token operator">-</span>Persist LocalMachine <span class="token operator">-</span><span class="token function">Type</span> Generic
</code></pre></div><h4 id="using-stored-credentials-in-scripts"><a href="#using-stored-credentials-in-scripts" class="header-anchor">#</a> Using Stored Credentials in Scripts</h4> <p>To use the stored credentials in your scripts:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># Import the CredentialManager module</span>
<span class="token function">Import-Module</span> CredentialManager

<span class="token comment"># Retrieve the stored credential</span>
<span class="token variable">$storedCred</span> = <span class="token function">Get-StoredCredential</span> <span class="token operator">-</span>Target <span class="token string">&quot;SupabaseDB&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$storedCred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Get the password from the credential</span>
    <span class="token variable">$dbPassword</span> = <span class="token variable">$storedCred</span><span class="token punctuation">.</span>GetNetworkCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Password
    <span class="token comment"># Set the password as environment variable</span>
    <span class="token variable">$env</span>:PGPASSWORD = <span class="token variable">$dbPassword</span>
<span class="token punctuation">}</span>

<span class="token comment"># Run your PostgreSQL command</span>
&amp; <span class="token string">&quot;C:\Program Files\PostgreSQL\17\bin\psql.exe&quot;</span> <span class="token string">&quot;host=aws-0-eu-central-1.pooler.supabase.com port=5432 dbname=postgres user=postgres.wnaxmgtrdhlousolblcr sslmode=require&quot;</span> <span class="token operator">-</span>c <span class="token string">&quot;YOUR SQL QUERY HERE&quot;</span>

<span class="token comment"># Clear the password from environment for security</span>
<span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;&quot;</span>
</code></pre></div><h2 id="_3-working-with-user-data"><a href="#_3-working-with-user-data" class="header-anchor">#</a> 3. Working with User Data</h2> <h3 id="querying-users"><a href="#querying-users" class="header-anchor">#</a> Querying Users</h3> <p>Basic query to get users:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    u<span class="token punctuation">.</span>id<span class="token punctuation">,</span> 
    u<span class="token punctuation">.</span>email<span class="token punctuation">,</span> 
    u<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
    p<span class="token punctuation">.</span>username
<span class="token keyword">FROM</span> auth<span class="token punctuation">.</span>users u
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>profiles p <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> p<span class="token punctuation">.</span>id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> u<span class="token punctuation">.</span>created_at <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-powershell-to-execute-queries"><a href="#using-powershell-to-execute-queries" class="header-anchor">#</a> Using PowerShell to Execute Queries</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># Import the CredentialManager module</span>
<span class="token function">Import-Module</span> CredentialManager

<span class="token comment"># Retrieve the stored credential</span>
<span class="token variable">$storedCred</span> = <span class="token function">Get-StoredCredential</span> <span class="token operator">-</span>Target <span class="token string">&quot;SupabaseDB&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$storedCred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Get the password from the credential</span>
    <span class="token variable">$env</span>:PGPASSWORD = <span class="token variable">$storedCred</span><span class="token punctuation">.</span>GetNetworkCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Password
<span class="token punctuation">}</span>

<span class="token comment"># Execute query</span>
&amp; <span class="token string">&quot;C:\Program Files\PostgreSQL\17\bin\psql.exe&quot;</span> <span class="token string">&quot;host=aws-0-eu-central-1.pooler.supabase.com port=5432 dbname=postgres user=postgres.wnaxmgtrdhlousolblcr sslmode=require&quot;</span> <span class="token operator">-</span>c <span class="token string">&quot;YOUR SQL QUERY HERE&quot;</span>

<span class="token comment"># Clear password from environment</span>
<span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;&quot;</span>
</code></pre></div><h2 id="_4-managing-test-users"><a href="#_4-managing-test-users" class="header-anchor">#</a> 4. Managing Test Users</h2> <h3 id="finding-test-users"><a href="#finding-test-users" class="header-anchor">#</a> Finding Test Users</h3> <p>Query to find test users with specific patterns:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    u<span class="token punctuation">.</span>id<span class="token punctuation">,</span> 
    u<span class="token punctuation">.</span>email<span class="token punctuation">,</span> 
    p<span class="token punctuation">.</span>username
<span class="token keyword">FROM</span> auth<span class="token punctuation">.</span>users u
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>profiles p <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> p<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> u<span class="token punctuation">.</span>email <span class="token operator">LIKE</span> <span class="token string">'%test%@gmail.com'</span>
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="deleting-test-users"><a href="#deleting-test-users" class="header-anchor">#</a> Deleting Test Users</h3> <p>Transaction-safe deletion of test users:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token comment">-- Delete from profiles first (to maintain referential integrity)</span>
  <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token keyword">public</span><span class="token punctuation">.</span>profiles 
  <span class="token keyword">WHERE</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> auth<span class="token punctuation">.</span>users 
    <span class="token keyword">WHERE</span> email <span class="token operator">LIKE</span> <span class="token string">'%test%@gmail.com'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">-- Then delete the users themselves</span>
  <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> auth<span class="token punctuation">.</span>users 
  <span class="token keyword">WHERE</span> email <span class="token operator">LIKE</span> <span class="token string">'%test%@gmail.com'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5-code-snippets-reusable-scripts"><a href="#_5-code-snippets-reusable-scripts" class="header-anchor">#</a> 5. Code Snippets &amp; Reusable Scripts</h2> <h3 id="query-test-users-script"><a href="#query-test-users-script" class="header-anchor">#</a> Query Test Users Script</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># query_test_users.ps1</span>
<span class="token comment"># Script to query test users from Supabase</span>

<span class="token comment"># Import the CredentialManager module</span>
<span class="token function">Import-Module</span> CredentialManager

<span class="token comment"># Retrieve the stored credential</span>
<span class="token variable">$storedCred</span> = <span class="token function">Get-StoredCredential</span> <span class="token operator">-</span>Target <span class="token string">&quot;SupabaseDB&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$storedCred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Get the password from the credential</span>
    <span class="token variable">$env</span>:PGPASSWORD = <span class="token variable">$storedCred</span><span class="token punctuation">.</span>GetNetworkCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Password
<span class="token punctuation">}</span>

<span class="token comment"># Full path to PSQL</span>
<span class="token variable">$psqlPath</span> = <span class="token string">&quot;C:\Program Files\PostgreSQL\17\bin\psql.exe&quot;</span>

<span class="token comment"># Run the query to find test users</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;Running query to find test users...&quot;</span>

<span class="token comment"># Use -o parameter to output to a file instead of relying on pager</span>
<span class="token variable">$outputFile</span> = <span class="token string">&quot;test_users_results.txt&quot;</span>
&amp; <span class="token string">&quot;<span class="token variable">$psqlPath</span>&quot;</span> <span class="token string">&quot;host=aws-0-eu-central-1.pooler.supabase.com port=5432 dbname=postgres user=postgres.wnaxmgtrdhlousolblcr sslmode=require&quot;</span> <span class="token operator">-</span>c <span class="token string">&quot;SELECT u.id, u.email, p.username FROM auth.users u LEFT JOIN public.profiles p ON u.id = p.id WHERE u.email LIKE '%test%@gmail.com' LIMIT 5;&quot;</span> <span class="token operator">-</span>o <span class="token variable">$outputFile</span>

<span class="token comment"># Display the results</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token variable">$outputFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Test users found:&quot;</span>
    <span class="token function">Get-Content</span> <span class="token variable">$outputFile</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;No results were returned or there was an error.&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># Clear the password from environment for security</span>
<span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;&quot;</span>

<span class="token function">Write-Host</span> <span class="token string">&quot;Query completed.&quot;</span>
</code></pre></div><h3 id="delete-test-users-script"><a href="#delete-test-users-script" class="header-anchor">#</a> Delete Test Users Script</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># delete_test_users.ps1</span>
<span class="token comment"># Script to delete test users from Supabase database</span>

<span class="token comment"># Import the CredentialManager module</span>
<span class="token function">Import-Module</span> CredentialManager

<span class="token comment"># Retrieve the stored credential</span>
<span class="token variable">$storedCred</span> = <span class="token function">Get-StoredCredential</span> <span class="token operator">-</span>Target <span class="token string">&quot;SupabaseDB&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$storedCred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Get the password from the credential</span>
    <span class="token variable">$env</span>:PGPASSWORD = <span class="token variable">$storedCred</span><span class="token punctuation">.</span>GetNetworkCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Password
<span class="token punctuation">}</span>

<span class="token comment"># Full path to PSQL</span>
<span class="token variable">$psqlPath</span> = <span class="token string">&quot;C:\Program Files\PostgreSQL\17\bin\psql.exe&quot;</span>

<span class="token comment"># SQL for deleting test users</span>
<span class="token variable">$deleteUsersSQL</span> = @<span class="token string">&quot;
BEGIN;
  -- Delete from profiles first (to maintain referential integrity)
  DELETE FROM public.profiles 
  WHERE id IN (
    SELECT id FROM auth.users 
    WHERE email LIKE '%test%@gmail.com'
  );
  
  -- Then delete the users themselves
  DELETE FROM auth.users 
  WHERE email LIKE '%test%@gmail.com';
COMMIT;
&quot;</span>@

<span class="token comment"># Save the SQL to a file</span>
<span class="token variable">$deleteUsersSQL</span> <span class="token punctuation">|</span> <span class="token function">Out-File</span> <span class="token operator">-</span>FilePath <span class="token string">&quot;delete_test_users.sql&quot;</span> <span class="token operator">-</span>Encoding utf8

<span class="token comment"># Run the deletion script</span>
<span class="token function">Write-Host</span> <span class="token string">&quot;Deleting test users...&quot;</span> <span class="token operator">-</span>ForegroundColor Yellow
&amp; <span class="token string">&quot;<span class="token variable">$psqlPath</span>&quot;</span> <span class="token string">&quot;host=aws-0-eu-central-1.pooler.supabase.com port=5432 dbname=postgres user=postgres.wnaxmgtrdhlousolblcr sslmode=require&quot;</span> <span class="token operator">-</span>f delete_test_users<span class="token punctuation">.</span>sql

<span class="token comment"># Clear the password from environment for security</span>
<span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;&quot;</span>

<span class="token function">Write-Host</span> <span class="token string">&quot;Test users deletion completed.&quot;</span> <span class="token operator">-</span>ForegroundColor Green
</code></pre></div><h2 id="_6-running-pgtap-tests"><a href="#_6-running-pgtap-tests" class="header-anchor">#</a> 6. Running pgTAP Tests</h2> <p>The project includes pgTAP tests for validating database functionality. These tests can be run using the <code>run_pgtap_tests.ps1</code> script, which also uses the secure credential management approach.</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># Import the CredentialManager module</span>
<span class="token function">Import-Module</span> CredentialManager

<span class="token comment"># Retrieve the stored credential</span>
<span class="token variable">$storedCred</span> = <span class="token function">Get-StoredCredential</span> <span class="token operator">-</span>Target <span class="token string">&quot;SupabaseDB&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$storedCred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Get the password from the credential</span>
    <span class="token variable">$dbPassword</span> = <span class="token variable">$storedCred</span><span class="token punctuation">.</span>GetNetworkCredential<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Password
    <span class="token comment"># Set the password as environment variable</span>
    <span class="token variable">$env</span>:PGPASSWORD = <span class="token variable">$dbPassword</span>
<span class="token punctuation">}</span>

<span class="token comment"># Run pgTAP tests</span>
&amp; <span class="token variable">$psqlPath</span> <span class="token variable">$connectionString</span> <span class="token operator">-</span>f <span class="token variable">$testFile</span><span class="token punctuation">.</span>FullName <span class="token operator">-</span>o <span class="token variable">$outputFile</span>

<span class="token comment"># Clear the password from environment for security</span>
<span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;&quot;</span>
</code></pre></div><p>For more information on the pgTAP tests, see the README in the <code>tests/pgtap</code> directory.</p> <h2 id="_7-security-best-practices"><a href="#_7-security-best-practices" class="header-anchor">#</a> 7. Security Best Practices</h2> <h3 id="handling-database-passwords"><a href="#handling-database-passwords" class="header-anchor">#</a> Handling Database Passwords</h3> <ol><li><p><strong>Use Environment Variables</strong>: Store passwords in environment variables rather than hardcoding them</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;your_password_here&quot;</span>
<span class="token comment"># Use the password...</span>
<span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&quot;&quot;</span> <span class="token comment"># Clear after use</span>
</code></pre></div></li> <li><p><strong>Use .env Files</strong>: Store sensitive information in .env files (which are in .gitignore)</p></li> <li><p><strong>Avoid Command History</strong>: Don't pass passwords as command-line arguments where they might be stored in command history</p></li></ol> <h3 id="transaction-safety"><a href="#transaction-safety" class="header-anchor">#</a> Transaction Safety</h3> <p>Always use transactions for destructive operations:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token comment">-- Your destructive operations here</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre></div><p>This ensures that operations either complete fully or not at all, maintaining database integrity.</p> <h2 id="_8-troubleshooting"><a href="#_8-troubleshooting" class="header-anchor">#</a> 8. Troubleshooting</h2> <h3 id="common-psql-connection-issues"><a href="#common-psql-connection-issues" class="header-anchor">#</a> Common PSQL Connection Issues</h3> <ol><li><strong>SSL Mode</strong>: Supabase requires <code>sslmode=require</code> for connections</li> <li><strong>Password Prompts</strong>: If PGPASSWORD environment variable isn't set, you'll be prompted for a password</li> <li><strong>Path Issues</strong>: If psql isn't in your PATH, use the full path to the executable</li></ol> <h3 id="output-formatting-problems"><a href="#output-formatting-problems" class="header-anchor">#</a> Output Formatting Problems</h3> <ol><li><strong>Pager Issues</strong>: On Windows, the default pager might cause issues. Use <code>-o filename</code> to output to a file instead.</li> <li><strong>Line Ending Problems</strong>: If output files have strange formatting, ensure you're using UTF-8 encoding:<div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Out-File</span> <span class="token operator">-</span>FilePath <span class="token string">&quot;output.txt&quot;</span> <span class="token operator">-</span>Encoding utf8
</code></pre></div></li></ol> <h3 id="connection-string-format"><a href="#connection-string-format" class="header-anchor">#</a> Connection String Format</h3> <p>The correct format for the connection string is:</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;host=aws-0-eu-central-1.pooler.supabase.com port=5432 dbname=postgres user=postgres.wnaxmgtrdhlousolblcr sslmode=require&quot;
</code></pre></div><hr> <p>This guide was created on March 22, 2025, and reflects the current database structure and connection parameters as of that date.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/12/2025, 10:51:52 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/music-besties-vuepress-docs/assets/js/app.fdb73f2f.js" defer></script><script src="/music-besties-vuepress-docs/assets/js/2.29405f6f.js" defer></script><script src="/music-besties-vuepress-docs/assets/js/1.fbb16ce0.js" defer></script><script src="/music-besties-vuepress-docs/assets/js/39.35a0cd58.js" defer></script>
  </body>
</html>
